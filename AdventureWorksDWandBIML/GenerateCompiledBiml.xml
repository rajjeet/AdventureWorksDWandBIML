<Biml xmlns="http://schemas.varigence.com/biml.xsd">
  <Connections>
    <OleDbConnection Name="OLEDB_Staging" CreateInProject="true" ConnectionString="Data Source=localhost;Integrated Security=SSPI;Initial Catalog=BimlDW;Provider=SQLNCLI11.1;" />
    <OleDbConnection Name="OLEDB_Source" CreateInProject="true" ConnectionString="Data Source=localhost;Integrated Security=SSPI;Initial Catalog=AdventureWorks2012;Provider=SQLNCLI11.1;" />
    <FlatFileConnection Name="FFC stage_Product" FilePath="C:\Users\rajje\Documents\visual studio 2015\Projects\AdventureWorksDWandBIML\AdventureWorksDWandBIML\errors\stage_Product.txt" FileFormat="FFF stage_Product" />
    <FlatFileConnection Name="FFC stage_ProductCategory" FilePath="C:\Users\rajje\Documents\visual studio 2015\Projects\AdventureWorksDWandBIML\AdventureWorksDWandBIML\errors\stage_ProductCategory.txt" FileFormat="FFF stage_ProductCategory" />
    <FlatFileConnection Name="FFC stage_ProductSubcategory" FilePath="C:\Users\rajje\Documents\visual studio 2015\Projects\AdventureWorksDWandBIML\AdventureWorksDWandBIML\errors\stage_ProductSubcategory.txt" FileFormat="FFF stage_ProductSubcategory" />
    <FlatFileConnection Name="FFC stage_SalesOrderDetail" FilePath="C:\Users\rajje\Documents\visual studio 2015\Projects\AdventureWorksDWandBIML\AdventureWorksDWandBIML\errors\stage_SalesOrderDetail.txt" FileFormat="FFF stage_SalesOrderDetail" />
    <FlatFileConnection Name="FFC stage_SalesOrderHeader" FilePath="C:\Users\rajje\Documents\visual studio 2015\Projects\AdventureWorksDWandBIML\AdventureWorksDWandBIML\errors\stage_SalesOrderHeader.txt" FileFormat="FFF stage_SalesOrderHeader" />
  </Connections>
  <Tables>
    <Table Name="Product" SchemaName="sourceDb.Production">
      <Annotations>
        <Annotation Tag="SourceQuery">
                        SELECT [ProductID], [Name], [ProductNumber], [MakeFlag], [FinishedGoodsFlag], [Color], [SafetyStockLevel], [ReorderPoint], [StandardCost], [ListPrice], [Size], [SizeUnitMeasureCode], [WeightUnitMeasureCode], [Weight], [DaysToManufacture], [ProductLine], [Class], [Style], [ProductSubcategoryID], [ProductModelID], [SellStartDate], [SellEndDate], [DiscontinuedDate], [rowguid], [ModifiedDate]
                        FROM [Production].[Product]
                    </Annotation>
        <Annotation Tag="Type">Staging</Annotation>
      </Annotations>
      <Columns>
        <Column Name="ProductID" />
        <Column Name="Name" DataType="String" Length="50" />
        <Column Name="ProductNumber" DataType="String" Length="25" />
        <Column Name="MakeFlag" DataType="Boolean" />
        <Column Name="FinishedGoodsFlag" DataType="Boolean" />
        <Column Name="Color" DataType="String" Length="15" IsNullable="true" />
        <Column Name="SafetyStockLevel" DataType="Int16" />
        <Column Name="ReorderPoint" DataType="Int16" />
        <Column Name="StandardCost" DataType="Currency" />
        <Column Name="ListPrice" DataType="Currency" />
        <Column Name="Size" DataType="String" Length="5" IsNullable="true" />
        <Column Name="SizeUnitMeasureCode" DataType="StringFixedLength" Length="3" IsNullable="true" />
        <Column Name="WeightUnitMeasureCode" DataType="StringFixedLength" Length="3" IsNullable="true" />
        <Column Name="Weight" DataType="Decimal" Precision="8" Scale="2" IsNullable="true" />
        <Column Name="DaysToManufacture" />
        <Column Name="ProductLine" DataType="StringFixedLength" Length="2" IsNullable="true" />
        <Column Name="Class" DataType="StringFixedLength" Length="2" IsNullable="true" />
        <Column Name="Style" DataType="StringFixedLength" Length="2" IsNullable="true" />
        <Column Name="ProductSubcategoryID" IsNullable="true" />
        <Column Name="ProductModelID" IsNullable="true" />
        <Column Name="SellStartDate" DataType="DateTime" />
        <Column Name="SellEndDate" DataType="DateTime" IsNullable="true" />
        <Column Name="DiscontinuedDate" DataType="DateTime" IsNullable="true" />
        <Column Name="rowguid" DataType="Guid" />
        <Column Name="ModifiedDate" DataType="DateTime" />
      </Columns>
    </Table>
    <Table Name="ProductCategory" SchemaName="sourceDb.Production">
      <Annotations>
        <Annotation Tag="SourceQuery">
                        SELECT [ProductCategoryID], [Name], [rowguid], [ModifiedDate]
                        FROM [Production].[ProductCategory]
                    </Annotation>
        <Annotation Tag="Type">Staging</Annotation>
      </Annotations>
      <Columns>
        <Column Name="ProductCategoryID" />
        <Column Name="Name" DataType="String" Length="50" />
        <Column Name="rowguid" DataType="Guid" />
        <Column Name="ModifiedDate" DataType="DateTime" />
      </Columns>
    </Table>
    <Table Name="ProductSubcategory" SchemaName="sourceDb.Production">
      <Annotations>
        <Annotation Tag="SourceQuery">
                        SELECT [ProductSubcategoryID], [ProductCategoryID], [Name], [rowguid], [ModifiedDate]
                        FROM [Production].[ProductSubcategory]
                    </Annotation>
        <Annotation Tag="Type">Staging</Annotation>
      </Annotations>
      <Columns>
        <Column Name="ProductSubcategoryID" />
        <Column Name="ProductCategoryID" />
        <Column Name="Name" DataType="String" Length="50" />
        <Column Name="rowguid" DataType="Guid" />
        <Column Name="ModifiedDate" DataType="DateTime" />
      </Columns>
    </Table>
    <Table Name="SalesOrderDetail" SchemaName="sourceDb.Sales">
      <Annotations>
        <Annotation Tag="SourceQuery">
                        SELECT [SalesOrderID], [SalesOrderDetailID], [CarrierTrackingNumber], [OrderQty], [ProductID], [SpecialOfferID], [UnitPrice], [UnitPriceDiscount], [LineTotal], [rowguid], [ModifiedDate]
                        FROM [Sales].[SalesOrderDetail]
                    </Annotation>
        <Annotation Tag="Type">Staging</Annotation>
        <Annotation Tag="IsIncremental">1</Annotation>
        <Annotation Tag="IncrementColumn">ModifiedDate</Annotation>
      </Annotations>
      <Columns>
        <Column Name="SalesOrderID" />
        <Column Name="SalesOrderDetailID" />
        <Column Name="CarrierTrackingNumber" DataType="String" Length="25" IsNullable="true" />
        <Column Name="OrderQty" DataType="Int16" />
        <Column Name="ProductID" />
        <Column Name="SpecialOfferID" />
        <Column Name="UnitPrice" DataType="Currency" />
        <Column Name="UnitPriceDiscount" DataType="Currency" />
        <Column Name="LineTotal" DataType="Decimal" Precision="38" Scale="6" />
        <Column Name="rowguid" DataType="Guid" />
        <Column Name="ModifiedDate" DataType="DateTime" />
      </Columns>
    </Table>
    <Table Name="SalesOrderHeader" SchemaName="sourceDb.Sales">
      <Annotations>
        <Annotation Tag="SourceQuery">
                        SELECT [SalesOrderID], [RevisionNumber], [OrderDate], [DueDate], [ShipDate], [Status], [OnlineOrderFlag], [SalesOrderNumber], [PurchaseOrderNumber], [AccountNumber], [CustomerID], [SalesPersonID], [TerritoryID], [BillToAddressID], [ShipToAddressID], [ShipMethodID], [CreditCardID], [CreditCardApprovalCode], [CurrencyRateID], [SubTotal], [TaxAmt], [Freight], [TotalDue], [Comment], [rowguid], [ModifiedDate]
                        FROM [Sales].[SalesOrderHeader]
                    </Annotation>
        <Annotation Tag="Type">Staging</Annotation>
        <Annotation Tag="IsIncremental">1</Annotation>
        <Annotation Tag="IncrementColumn">ModifiedDate</Annotation>
      </Annotations>
      <Columns>
        <Column Name="SalesOrderID" />
        <Column Name="RevisionNumber" DataType="Byte" />
        <Column Name="OrderDate" DataType="DateTime" />
        <Column Name="DueDate" DataType="DateTime" />
        <Column Name="ShipDate" DataType="DateTime" IsNullable="true" />
        <Column Name="Status" DataType="Byte" />
        <Column Name="OnlineOrderFlag" DataType="Boolean" />
        <Column Name="SalesOrderNumber" DataType="String" Length="25" />
        <Column Name="PurchaseOrderNumber" DataType="String" Length="25" IsNullable="true" />
        <Column Name="AccountNumber" DataType="String" Length="15" IsNullable="true" />
        <Column Name="CustomerID" />
        <Column Name="SalesPersonID" IsNullable="true" />
        <Column Name="TerritoryID" IsNullable="true" />
        <Column Name="BillToAddressID" />
        <Column Name="ShipToAddressID" />
        <Column Name="ShipMethodID" />
        <Column Name="CreditCardID" IsNullable="true" />
        <Column Name="CreditCardApprovalCode" DataType="AnsiString" Length="15" IsNullable="true" />
        <Column Name="CurrencyRateID" IsNullable="true" />
        <Column Name="SubTotal" DataType="Currency" />
        <Column Name="TaxAmt" DataType="Currency" />
        <Column Name="Freight" DataType="Currency" />
        <Column Name="TotalDue" DataType="Currency" />
        <Column Name="Comment" DataType="String" Length="128" IsNullable="true" />
        <Column Name="rowguid" DataType="Guid" />
        <Column Name="ModifiedDate" DataType="DateTime" />
      </Columns>
    </Table>
  </Tables>
  <Packages>
    <Package Name="Generate Staging Schema" ProtectionLevel="EncryptSensitiveWithUserKey">
      <Tasks>
        <ExecuteSQL Name="SQL Drop and Create Production_Product" ConnectionName="OLEDB_Staging">
          <DirectInput>SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-------------------------------------------------------------------
IF EXISTS (SELECT * from sys.objects WHERE object_id = OBJECT_ID(N'[stage].[Product]') AND type IN (N'U'))
DROP TABLE [stage].[Product]
GO

CREATE TABLE [stage].[Product]
(
-- Columns Definition
	[ProductID] int NOT NULL 
,	[Name] nvarchar(50) NOT NULL 
,	[ProductNumber] nvarchar(25) NOT NULL 
,	[MakeFlag] bit NOT NULL 
,	[FinishedGoodsFlag] bit NOT NULL 
,	[Color] nvarchar(15) 
,	[SafetyStockLevel] smallint NOT NULL 
,	[ReorderPoint] smallint NOT NULL 
,	[StandardCost] money NOT NULL 
,	[ListPrice] money NOT NULL 
,	[Size] nvarchar(5) 
,	[SizeUnitMeasureCode] nchar(3) 
,	[WeightUnitMeasureCode] nchar(3) 
,	[Weight] decimal(8,2) 
,	[DaysToManufacture] int NOT NULL 
,	[ProductLine] nchar(2) 
,	[Class] nchar(2) 
,	[Style] nchar(2) 
,	[ProductSubcategoryID] int 
,	[ProductModelID] int 
,	[SellStartDate] datetime NOT NULL 
,	[SellEndDate] datetime 
,	[DiscontinuedDate] datetime 
,	[rowguid] uniqueidentifier NOT NULL 
,	[ModifiedDate] datetime NOT NULL 

-- Constraints

)
ON "default"
WITH (DATA_COMPRESSION = NONE)
GO

-------------------------------------------------------------------





                    </DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Drop and Create Production_ProductCategory" ConnectionName="OLEDB_Staging">
          <DirectInput>SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-------------------------------------------------------------------
IF EXISTS (SELECT * from sys.objects WHERE object_id = OBJECT_ID(N'[stage].[ProductCategory]') AND type IN (N'U'))
DROP TABLE [stage].[ProductCategory]
GO

CREATE TABLE [stage].[ProductCategory]
(
-- Columns Definition
	[ProductCategoryID] int NOT NULL 
,	[Name] nvarchar(50) NOT NULL 
,	[rowguid] uniqueidentifier NOT NULL 
,	[ModifiedDate] datetime NOT NULL 

-- Constraints

)
ON "default"
WITH (DATA_COMPRESSION = NONE)
GO

-------------------------------------------------------------------





                    </DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Drop and Create Production_ProductSubcategory" ConnectionName="OLEDB_Staging">
          <DirectInput>SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-------------------------------------------------------------------
IF EXISTS (SELECT * from sys.objects WHERE object_id = OBJECT_ID(N'[stage].[ProductSubcategory]') AND type IN (N'U'))
DROP TABLE [stage].[ProductSubcategory]
GO

CREATE TABLE [stage].[ProductSubcategory]
(
-- Columns Definition
	[ProductSubcategoryID] int NOT NULL 
,	[ProductCategoryID] int NOT NULL 
,	[Name] nvarchar(50) NOT NULL 
,	[rowguid] uniqueidentifier NOT NULL 
,	[ModifiedDate] datetime NOT NULL 

-- Constraints

)
ON "default"
WITH (DATA_COMPRESSION = NONE)
GO

-------------------------------------------------------------------





                    </DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Drop and Create Sales_SalesOrderDetail" ConnectionName="OLEDB_Staging">
          <DirectInput>SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-------------------------------------------------------------------
IF EXISTS (SELECT * from sys.objects WHERE object_id = OBJECT_ID(N'[stage].[SalesOrderDetail]') AND type IN (N'U'))
DROP TABLE [stage].[SalesOrderDetail]
GO

CREATE TABLE [stage].[SalesOrderDetail]
(
-- Columns Definition
	[SalesOrderID] int NOT NULL 
,	[SalesOrderDetailID] int NOT NULL 
,	[CarrierTrackingNumber] nvarchar(25) 
,	[OrderQty] smallint NOT NULL 
,	[ProductID] int NOT NULL 
,	[SpecialOfferID] int NOT NULL 
,	[UnitPrice] money NOT NULL 
,	[UnitPriceDiscount] money NOT NULL 
,	[LineTotal] decimal(38,6) NOT NULL 
,	[rowguid] uniqueidentifier NOT NULL 
,	[ModifiedDate] datetime NOT NULL 

-- Constraints

)
ON "default"
WITH (DATA_COMPRESSION = NONE)
GO

-------------------------------------------------------------------





                    </DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Drop and Create Sales_SalesOrderHeader" ConnectionName="OLEDB_Staging">
          <DirectInput>SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-------------------------------------------------------------------
IF EXISTS (SELECT * from sys.objects WHERE object_id = OBJECT_ID(N'[stage].[SalesOrderHeader]') AND type IN (N'U'))
DROP TABLE [stage].[SalesOrderHeader]
GO

CREATE TABLE [stage].[SalesOrderHeader]
(
-- Columns Definition
	[SalesOrderID] int NOT NULL 
,	[RevisionNumber] tinyint NOT NULL 
,	[OrderDate] datetime NOT NULL 
,	[DueDate] datetime NOT NULL 
,	[ShipDate] datetime 
,	[Status] tinyint NOT NULL 
,	[OnlineOrderFlag] bit NOT NULL 
,	[SalesOrderNumber] nvarchar(25) NOT NULL 
,	[PurchaseOrderNumber] nvarchar(25) 
,	[AccountNumber] nvarchar(15) 
,	[CustomerID] int NOT NULL 
,	[SalesPersonID] int 
,	[TerritoryID] int 
,	[BillToAddressID] int NOT NULL 
,	[ShipToAddressID] int NOT NULL 
,	[ShipMethodID] int NOT NULL 
,	[CreditCardID] int 
,	[CreditCardApprovalCode] varchar(15) 
,	[CurrencyRateID] int 
,	[SubTotal] money NOT NULL 
,	[TaxAmt] money NOT NULL 
,	[Freight] money NOT NULL 
,	[TotalDue] money NOT NULL 
,	[Comment] nvarchar(128) 
,	[rowguid] uniqueidentifier NOT NULL 
,	[ModifiedDate] datetime NOT NULL 

-- Constraints

)
ON "default"
WITH (DATA_COMPRESSION = NONE)
GO

-------------------------------------------------------------------





                    </DirectInput>
        </ExecuteSQL>
      </Tasks>
      <Connections>
        <Connection ConnectionName="OLEDB_Staging" />
      </Connections>
    </Package>
    <Package Name="Extract Production_Product" ConstraintMode="Linear" ProtectionLevel="EncryptSensitiveWithUserKey">
      <Variables>
        <Variable Name="ParentAuditId" DataType="Int32" EvaluateAsExpression="true">@[$Package::ParentAuditId]</Variable>
        <Variable Name="AuditId" DataType="Int32">-1</Variable>
        <Variable Name="TableSchemaName" DataType="String">Production</Variable>
        <Variable Name="TableName" DataType="String">Product</Variable>
        <Variable Name="SourceQuery" DataType="String">
                        SELECT [ProductID], [Name], [ProductNumber], [MakeFlag], [FinishedGoodsFlag], [Color], [SafetyStockLevel], [ReorderPoint], [StandardCost], [ListPrice], [Size], [SizeUnitMeasureCode], [WeightUnitMeasureCode], [Weight], [DaysToManufacture], [ProductLine], [Class], [Style], [ProductSubcategoryID], [ProductModelID], [SellStartDate], [SellEndDate], [DiscontinuedDate], [rowguid], [ModifiedDate]
                        FROM [Production].[Product]
                    </Variable>
        <Variable Name="ExtractRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="InsertRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="UpdateRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="ErrorRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="InitialTableRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="FinalTableRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="TableMaxDateTime" DataType="DateTime">1900-01-01</Variable>
        <Variable Name="IsSuccessful" DataType="String">N</Variable>
      </Variables>
      <Tasks>
        <ExecuteSQL Name="SQL Truncate stage_Product" ConnectionName="OLEDB_Staging">
          <DirectInput>TRUNCATE TABLE [stage].[Product];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Count Initial stage_Product" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.InitialTableRowCnt" />
          </Results>
          <DirectInput>SELECT COUNT(*) FROM [stage].[Product];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Audit Begin" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.AuditId" />
          </Results>
          <Parameters>
            <Parameter Name="@ParentAuditId" VariableName="User.ParentAuditId" DataType="Int32" />
            <Parameter Name="@ExecutionInstanceGUID" VariableName="System.ExecutionInstanceGUID" DataType="Guid" />
            <Parameter Name="@MachineName" VariableName="System.MachineName" DataType="String" />
            <Parameter Name="@PackageID" VariableName="System.PackageID" DataType="Guid" />
            <Parameter Name="@ServerExecutionId" VariableName="System.ServerExecutionID" DataType="String" />
            <Parameter Name="@StartTime" VariableName="System.StartTime" DataType="DateTime" />
            <Parameter Name="@UserName" VariableName="System.UserName" DataType="String" />
            <Parameter Name="@VersionBuild" VariableName="System.VersionBuild" DataType="Int16" />
            <Parameter Name="@VersionGUID" VariableName="System.VersionGUID" DataType="Guid" />
            <Parameter Name="@VersionMajor" VariableName="System.VersionMajor" DataType="Int32" />
            <Parameter Name="@VersionMinor" VariableName="System.VersionMinor" DataType="Int32" />
            <Parameter Name="@TableSchemaName" VariableName="User.TableSchemaName" DataType="String" />
            <Parameter Name="@TableName" VariableName="User.TableName" DataType="String" />
            <Parameter Name="@ExtractRowCnt" VariableName="User.ExtractRowCnt" DataType="Int32" />
            <Parameter Name="@InsertRowCnt" VariableName="User.InsertRowCnt" DataType="Int32" />
            <Parameter Name="@UpdateRowCnt" VariableName="User.UpdateRowCnt" DataType="Int32" />
            <Parameter Name="@ErrorRowCnt" VariableName="User.ErrorRowCnt" DataType="Int32" />
            <Parameter Name="@InitialTableRowCnt" VariableName="User.InitialTableRowCnt" DataType="Int32" />
            <Parameter Name="@FinalTableRowCnt" VariableName="User.FinalTableRowCnt" DataType="Int32" />
            <Parameter Name="@TableMaxDateTime" VariableName="User.TableMaxDateTime" DataType="DateTime" />
            <Parameter Name="@IsSuccessful" VariableName="User.IsSuccessful" DataType="String" />
          </Parameters>
          <DirectInput>
        exec dbo.spIns_Audit ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?, ?
                        
    </DirectInput>
        </ExecuteSQL>
        <Dataflow Name="DFT Extract Production_Product to Staging">
          <Transformations>
            <OleDbSource Name="OLEDBSRC Production_Product" ConnectionName="OLEDB_Source">
              <VariableInput VariableName="User.SourceQuery" />
            </OleDbSource>
            <RowCount Name="RC Extract" VariableName="User.ExtractRowCnt" />
            <OleDbDestination Name="OLEDBDEST stage_Product" ConnectionName="OLEDB_Staging">
              <ErrorHandling ErrorRowDisposition="RedirectRow" TruncationRowDisposition="RedirectRow" />
              <ExternalTableOutput Table="[stage].[Product]" />
            </OleDbDestination>
            <RowCount Name="RC Error" VariableName="User.ErrorRowCnt">
              <InputPath OutputPathName="OLEDBDEST stage_Product.Error" />
            </RowCount>
            <FlatFileDestination Name="FF Errors stage_Product" ConnectionName="FFC stage_Product">
              <InputPath OutputPathName="RC Error.Output" />
            </FlatFileDestination>
          </Transformations>
        </Dataflow>
        <ExecuteSQL Name="SQL Count Final stage_Product" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.FinalTableRowCnt" />
          </Results>
          <DirectInput>SELECT COUNT(*) FROM [stage].[Product];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Audit End" ConnectionName="OLEDB_Staging">
          <Parameters>
            <Parameter Name="@AuditId" VariableName="User.AuditId" DataType="Int32" />
            <Parameter Name="@ExtractRowCnt" VariableName="User.ExtractRowCnt" DataType="Int32" />
            <Parameter Name="@InsertRowCnt" VariableName="User.InsertRowCnt" DataType="Int32" />
            <Parameter Name="@UpdateRowCnt" VariableName="User.UpdateRowCnt" DataType="Int32" />
            <Parameter Name="@ErrorRowCnt" VariableName="User.ErrorRowCnt" DataType="Int32" />
            <Parameter Name="@InitialTableRowCnt" VariableName="User.InitialTableRowCnt" DataType="Int32" />
            <Parameter Name="@FinalTableRowCnt" VariableName="User.FinalTableRowCnt" DataType="Int32" />
            <Parameter Name="@TableMaxDateTime" VariableName="User.TableMaxDateTime" DataType="DateTime" />
          </Parameters>
          <DirectInput>
        exec spUpd_Audit ?, ?, ?, ?, ?, ?, ?, ?
    </DirectInput>
        </ExecuteSQL>
      </Tasks>
      <Connections>
        <Connection ConnectionName="FFC stage_Product" />
      </Connections>
      <Parameters>
        <Parameter Name="ParentAuditId" DataType="Int32">-1</Parameter>
      </Parameters>
    </Package>
    <Package Name="Extract Production_ProductCategory" ConstraintMode="Linear" ProtectionLevel="EncryptSensitiveWithUserKey">
      <Variables>
        <Variable Name="ParentAuditId" DataType="Int32" EvaluateAsExpression="true">@[$Package::ParentAuditId]</Variable>
        <Variable Name="AuditId" DataType="Int32">-1</Variable>
        <Variable Name="TableSchemaName" DataType="String">Production</Variable>
        <Variable Name="TableName" DataType="String">ProductCategory</Variable>
        <Variable Name="SourceQuery" DataType="String">
                        SELECT [ProductCategoryID], [Name], [rowguid], [ModifiedDate]
                        FROM [Production].[ProductCategory]
                    </Variable>
        <Variable Name="ExtractRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="InsertRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="UpdateRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="ErrorRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="InitialTableRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="FinalTableRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="TableMaxDateTime" DataType="DateTime">1900-01-01</Variable>
        <Variable Name="IsSuccessful" DataType="String">N</Variable>
      </Variables>
      <Tasks>
        <ExecuteSQL Name="SQL Truncate stage_ProductCategory" ConnectionName="OLEDB_Staging">
          <DirectInput>TRUNCATE TABLE [stage].[ProductCategory];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Count Initial stage_ProductCategory" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.InitialTableRowCnt" />
          </Results>
          <DirectInput>SELECT COUNT(*) FROM [stage].[ProductCategory];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Audit Begin" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.AuditId" />
          </Results>
          <Parameters>
            <Parameter Name="@ParentAuditId" VariableName="User.ParentAuditId" DataType="Int32" />
            <Parameter Name="@ExecutionInstanceGUID" VariableName="System.ExecutionInstanceGUID" DataType="Guid" />
            <Parameter Name="@MachineName" VariableName="System.MachineName" DataType="String" />
            <Parameter Name="@PackageID" VariableName="System.PackageID" DataType="Guid" />
            <Parameter Name="@ServerExecutionId" VariableName="System.ServerExecutionID" DataType="String" />
            <Parameter Name="@StartTime" VariableName="System.StartTime" DataType="DateTime" />
            <Parameter Name="@UserName" VariableName="System.UserName" DataType="String" />
            <Parameter Name="@VersionBuild" VariableName="System.VersionBuild" DataType="Int16" />
            <Parameter Name="@VersionGUID" VariableName="System.VersionGUID" DataType="Guid" />
            <Parameter Name="@VersionMajor" VariableName="System.VersionMajor" DataType="Int32" />
            <Parameter Name="@VersionMinor" VariableName="System.VersionMinor" DataType="Int32" />
            <Parameter Name="@TableSchemaName" VariableName="User.TableSchemaName" DataType="String" />
            <Parameter Name="@TableName" VariableName="User.TableName" DataType="String" />
            <Parameter Name="@ExtractRowCnt" VariableName="User.ExtractRowCnt" DataType="Int32" />
            <Parameter Name="@InsertRowCnt" VariableName="User.InsertRowCnt" DataType="Int32" />
            <Parameter Name="@UpdateRowCnt" VariableName="User.UpdateRowCnt" DataType="Int32" />
            <Parameter Name="@ErrorRowCnt" VariableName="User.ErrorRowCnt" DataType="Int32" />
            <Parameter Name="@InitialTableRowCnt" VariableName="User.InitialTableRowCnt" DataType="Int32" />
            <Parameter Name="@FinalTableRowCnt" VariableName="User.FinalTableRowCnt" DataType="Int32" />
            <Parameter Name="@TableMaxDateTime" VariableName="User.TableMaxDateTime" DataType="DateTime" />
            <Parameter Name="@IsSuccessful" VariableName="User.IsSuccessful" DataType="String" />
          </Parameters>
          <DirectInput>
        exec dbo.spIns_Audit ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?, ?
                        
    </DirectInput>
        </ExecuteSQL>
        <Dataflow Name="DFT Extract Production_ProductCategory to Staging">
          <Transformations>
            <OleDbSource Name="OLEDBSRC Production_ProductCategory" ConnectionName="OLEDB_Source">
              <VariableInput VariableName="User.SourceQuery" />
            </OleDbSource>
            <RowCount Name="RC Extract" VariableName="User.ExtractRowCnt" />
            <OleDbDestination Name="OLEDBDEST stage_ProductCategory" ConnectionName="OLEDB_Staging">
              <ErrorHandling ErrorRowDisposition="RedirectRow" TruncationRowDisposition="RedirectRow" />
              <ExternalTableOutput Table="[stage].[ProductCategory]" />
            </OleDbDestination>
            <RowCount Name="RC Error" VariableName="User.ErrorRowCnt">
              <InputPath OutputPathName="OLEDBDEST stage_ProductCategory.Error" />
            </RowCount>
            <FlatFileDestination Name="FF Errors stage_ProductCategory" ConnectionName="FFC stage_ProductCategory">
              <InputPath OutputPathName="RC Error.Output" />
            </FlatFileDestination>
          </Transformations>
        </Dataflow>
        <ExecuteSQL Name="SQL Count Final stage_ProductCategory" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.FinalTableRowCnt" />
          </Results>
          <DirectInput>SELECT COUNT(*) FROM [stage].[ProductCategory];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Audit End" ConnectionName="OLEDB_Staging">
          <Parameters>
            <Parameter Name="@AuditId" VariableName="User.AuditId" DataType="Int32" />
            <Parameter Name="@ExtractRowCnt" VariableName="User.ExtractRowCnt" DataType="Int32" />
            <Parameter Name="@InsertRowCnt" VariableName="User.InsertRowCnt" DataType="Int32" />
            <Parameter Name="@UpdateRowCnt" VariableName="User.UpdateRowCnt" DataType="Int32" />
            <Parameter Name="@ErrorRowCnt" VariableName="User.ErrorRowCnt" DataType="Int32" />
            <Parameter Name="@InitialTableRowCnt" VariableName="User.InitialTableRowCnt" DataType="Int32" />
            <Parameter Name="@FinalTableRowCnt" VariableName="User.FinalTableRowCnt" DataType="Int32" />
            <Parameter Name="@TableMaxDateTime" VariableName="User.TableMaxDateTime" DataType="DateTime" />
          </Parameters>
          <DirectInput>
        exec spUpd_Audit ?, ?, ?, ?, ?, ?, ?, ?
    </DirectInput>
        </ExecuteSQL>
      </Tasks>
      <Connections>
        <Connection ConnectionName="FFC stage_ProductCategory" />
      </Connections>
      <Parameters>
        <Parameter Name="ParentAuditId" DataType="Int32">-1</Parameter>
      </Parameters>
    </Package>
    <Package Name="Extract Production_ProductSubcategory" ConstraintMode="Linear" ProtectionLevel="EncryptSensitiveWithUserKey">
      <Variables>
        <Variable Name="ParentAuditId" DataType="Int32" EvaluateAsExpression="true">@[$Package::ParentAuditId]</Variable>
        <Variable Name="AuditId" DataType="Int32">-1</Variable>
        <Variable Name="TableSchemaName" DataType="String">Production</Variable>
        <Variable Name="TableName" DataType="String">ProductSubcategory</Variable>
        <Variable Name="SourceQuery" DataType="String">
                        SELECT [ProductSubcategoryID], [ProductCategoryID], [Name], [rowguid], [ModifiedDate]
                        FROM [Production].[ProductSubcategory]
                    </Variable>
        <Variable Name="ExtractRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="InsertRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="UpdateRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="ErrorRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="InitialTableRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="FinalTableRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="TableMaxDateTime" DataType="DateTime">1900-01-01</Variable>
        <Variable Name="IsSuccessful" DataType="String">N</Variable>
      </Variables>
      <Tasks>
        <ExecuteSQL Name="SQL Truncate stage_ProductSubcategory" ConnectionName="OLEDB_Staging">
          <DirectInput>TRUNCATE TABLE [stage].[ProductSubcategory];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Count Initial stage_ProductSubcategory" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.InitialTableRowCnt" />
          </Results>
          <DirectInput>SELECT COUNT(*) FROM [stage].[ProductSubcategory];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Audit Begin" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.AuditId" />
          </Results>
          <Parameters>
            <Parameter Name="@ParentAuditId" VariableName="User.ParentAuditId" DataType="Int32" />
            <Parameter Name="@ExecutionInstanceGUID" VariableName="System.ExecutionInstanceGUID" DataType="Guid" />
            <Parameter Name="@MachineName" VariableName="System.MachineName" DataType="String" />
            <Parameter Name="@PackageID" VariableName="System.PackageID" DataType="Guid" />
            <Parameter Name="@ServerExecutionId" VariableName="System.ServerExecutionID" DataType="String" />
            <Parameter Name="@StartTime" VariableName="System.StartTime" DataType="DateTime" />
            <Parameter Name="@UserName" VariableName="System.UserName" DataType="String" />
            <Parameter Name="@VersionBuild" VariableName="System.VersionBuild" DataType="Int16" />
            <Parameter Name="@VersionGUID" VariableName="System.VersionGUID" DataType="Guid" />
            <Parameter Name="@VersionMajor" VariableName="System.VersionMajor" DataType="Int32" />
            <Parameter Name="@VersionMinor" VariableName="System.VersionMinor" DataType="Int32" />
            <Parameter Name="@TableSchemaName" VariableName="User.TableSchemaName" DataType="String" />
            <Parameter Name="@TableName" VariableName="User.TableName" DataType="String" />
            <Parameter Name="@ExtractRowCnt" VariableName="User.ExtractRowCnt" DataType="Int32" />
            <Parameter Name="@InsertRowCnt" VariableName="User.InsertRowCnt" DataType="Int32" />
            <Parameter Name="@UpdateRowCnt" VariableName="User.UpdateRowCnt" DataType="Int32" />
            <Parameter Name="@ErrorRowCnt" VariableName="User.ErrorRowCnt" DataType="Int32" />
            <Parameter Name="@InitialTableRowCnt" VariableName="User.InitialTableRowCnt" DataType="Int32" />
            <Parameter Name="@FinalTableRowCnt" VariableName="User.FinalTableRowCnt" DataType="Int32" />
            <Parameter Name="@TableMaxDateTime" VariableName="User.TableMaxDateTime" DataType="DateTime" />
            <Parameter Name="@IsSuccessful" VariableName="User.IsSuccessful" DataType="String" />
          </Parameters>
          <DirectInput>
        exec dbo.spIns_Audit ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?, ?
                        
    </DirectInput>
        </ExecuteSQL>
        <Dataflow Name="DFT Extract Production_ProductSubcategory to Staging">
          <Transformations>
            <OleDbSource Name="OLEDBSRC Production_ProductSubcategory" ConnectionName="OLEDB_Source">
              <VariableInput VariableName="User.SourceQuery" />
            </OleDbSource>
            <RowCount Name="RC Extract" VariableName="User.ExtractRowCnt" />
            <OleDbDestination Name="OLEDBDEST stage_ProductSubcategory" ConnectionName="OLEDB_Staging">
              <ErrorHandling ErrorRowDisposition="RedirectRow" TruncationRowDisposition="RedirectRow" />
              <ExternalTableOutput Table="[stage].[ProductSubcategory]" />
            </OleDbDestination>
            <RowCount Name="RC Error" VariableName="User.ErrorRowCnt">
              <InputPath OutputPathName="OLEDBDEST stage_ProductSubcategory.Error" />
            </RowCount>
            <FlatFileDestination Name="FF Errors stage_ProductSubcategory" ConnectionName="FFC stage_ProductSubcategory">
              <InputPath OutputPathName="RC Error.Output" />
            </FlatFileDestination>
          </Transformations>
        </Dataflow>
        <ExecuteSQL Name="SQL Count Final stage_ProductSubcategory" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.FinalTableRowCnt" />
          </Results>
          <DirectInput>SELECT COUNT(*) FROM [stage].[ProductSubcategory];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Audit End" ConnectionName="OLEDB_Staging">
          <Parameters>
            <Parameter Name="@AuditId" VariableName="User.AuditId" DataType="Int32" />
            <Parameter Name="@ExtractRowCnt" VariableName="User.ExtractRowCnt" DataType="Int32" />
            <Parameter Name="@InsertRowCnt" VariableName="User.InsertRowCnt" DataType="Int32" />
            <Parameter Name="@UpdateRowCnt" VariableName="User.UpdateRowCnt" DataType="Int32" />
            <Parameter Name="@ErrorRowCnt" VariableName="User.ErrorRowCnt" DataType="Int32" />
            <Parameter Name="@InitialTableRowCnt" VariableName="User.InitialTableRowCnt" DataType="Int32" />
            <Parameter Name="@FinalTableRowCnt" VariableName="User.FinalTableRowCnt" DataType="Int32" />
            <Parameter Name="@TableMaxDateTime" VariableName="User.TableMaxDateTime" DataType="DateTime" />
          </Parameters>
          <DirectInput>
        exec spUpd_Audit ?, ?, ?, ?, ?, ?, ?, ?
    </DirectInput>
        </ExecuteSQL>
      </Tasks>
      <Connections>
        <Connection ConnectionName="FFC stage_ProductSubcategory" />
      </Connections>
      <Parameters>
        <Parameter Name="ParentAuditId" DataType="Int32">-1</Parameter>
      </Parameters>
    </Package>
    <Package Name="Extract Sales_SalesOrderDetail" ConstraintMode="Linear" ProtectionLevel="EncryptSensitiveWithUserKey">
      <Variables>
        <Variable Name="ParentAuditId" DataType="Int32" EvaluateAsExpression="true">@[$Package::ParentAuditId]</Variable>
        <Variable Name="AuditId" DataType="Int32">-1</Variable>
        <Variable Name="TableSchemaName" DataType="String">Sales</Variable>
        <Variable Name="TableName" DataType="String">SalesOrderDetail</Variable>
        <Variable Name="SourceQuery" DataType="String">
                        SELECT [SalesOrderID], [SalesOrderDetailID], [CarrierTrackingNumber], [OrderQty], [ProductID], [SpecialOfferID], [UnitPrice], [UnitPriceDiscount], [LineTotal], [rowguid], [ModifiedDate]
                        FROM [Sales].[SalesOrderDetail]
                    </Variable>
        <Variable Name="SourceQueryWhere" DataType="String"> WHERE [ModifiedDate] &gt; </Variable>
        <Variable Name="ExtractRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="InsertRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="UpdateRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="ErrorRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="InitialTableRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="FinalTableRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="TableMaxDateTime" DataType="DateTime">1900-01-01</Variable>
        <Variable Name="IsSuccessful" DataType="String">N</Variable>
      </Variables>
      <Tasks>
        <ExecuteSQL Name="SQL Truncate stage_SalesOrderDetail" ConnectionName="OLEDB_Staging">
          <DirectInput>TRUNCATE TABLE [stage].[SalesOrderDetail];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Count Initial stage_SalesOrderDetail" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.InitialTableRowCnt" />
          </Results>
          <DirectInput>SELECT COUNT(*) FROM [stage].[SalesOrderDetail];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Max Table DateTime" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.TableMaxDateTime" />
          </Results>
          <DirectInput>
                        SELECT MAX([TableMaxDateTime]) FROM [dbo].[Audit] 
                            WHERE [TableSchemaName] = 'Sales' AND [TableName] = 'SalesOrderDetail';
                    </DirectInput>
        </ExecuteSQL>
        <Expression Name="EXP SourceQuery" Expression="@[User::SourceQuery] = @[$Project::InitialLoad] ?                                              @[User::SourceQuery] :                                             @[User::SourceQuery] + @[User::SourceQueryWhere] +                                                 &quot;'&quot; + (DT_WSTR, 30) @[User::TableMaxDateTime] +  &quot;'&quot;" />
        <ExecuteSQL Name="SQL Audit Begin" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.AuditId" />
          </Results>
          <Parameters>
            <Parameter Name="@ParentAuditId" VariableName="User.ParentAuditId" DataType="Int32" />
            <Parameter Name="@ExecutionInstanceGUID" VariableName="System.ExecutionInstanceGUID" DataType="Guid" />
            <Parameter Name="@MachineName" VariableName="System.MachineName" DataType="String" />
            <Parameter Name="@PackageID" VariableName="System.PackageID" DataType="Guid" />
            <Parameter Name="@ServerExecutionId" VariableName="System.ServerExecutionID" DataType="String" />
            <Parameter Name="@StartTime" VariableName="System.StartTime" DataType="DateTime" />
            <Parameter Name="@UserName" VariableName="System.UserName" DataType="String" />
            <Parameter Name="@VersionBuild" VariableName="System.VersionBuild" DataType="Int16" />
            <Parameter Name="@VersionGUID" VariableName="System.VersionGUID" DataType="Guid" />
            <Parameter Name="@VersionMajor" VariableName="System.VersionMajor" DataType="Int32" />
            <Parameter Name="@VersionMinor" VariableName="System.VersionMinor" DataType="Int32" />
            <Parameter Name="@TableSchemaName" VariableName="User.TableSchemaName" DataType="String" />
            <Parameter Name="@TableName" VariableName="User.TableName" DataType="String" />
            <Parameter Name="@ExtractRowCnt" VariableName="User.ExtractRowCnt" DataType="Int32" />
            <Parameter Name="@InsertRowCnt" VariableName="User.InsertRowCnt" DataType="Int32" />
            <Parameter Name="@UpdateRowCnt" VariableName="User.UpdateRowCnt" DataType="Int32" />
            <Parameter Name="@ErrorRowCnt" VariableName="User.ErrorRowCnt" DataType="Int32" />
            <Parameter Name="@InitialTableRowCnt" VariableName="User.InitialTableRowCnt" DataType="Int32" />
            <Parameter Name="@FinalTableRowCnt" VariableName="User.FinalTableRowCnt" DataType="Int32" />
            <Parameter Name="@TableMaxDateTime" VariableName="User.TableMaxDateTime" DataType="DateTime" />
            <Parameter Name="@IsSuccessful" VariableName="User.IsSuccessful" DataType="String" />
          </Parameters>
          <DirectInput>
        exec dbo.spIns_Audit ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?, ?
                        
    </DirectInput>
        </ExecuteSQL>
        <Dataflow Name="DFT Extract Sales_SalesOrderDetail to Staging">
          <Transformations>
            <OleDbSource Name="OLEDBSRC Sales_SalesOrderDetail" ConnectionName="OLEDB_Source">
              <VariableInput VariableName="User.SourceQuery" />
            </OleDbSource>
            <RowCount Name="RC Extract" VariableName="User.ExtractRowCnt" />
            <OleDbDestination Name="OLEDBDEST stage_SalesOrderDetail" ConnectionName="OLEDB_Staging">
              <ErrorHandling ErrorRowDisposition="RedirectRow" TruncationRowDisposition="RedirectRow" />
              <ExternalTableOutput Table="[stage].[SalesOrderDetail]" />
            </OleDbDestination>
            <RowCount Name="RC Error" VariableName="User.ErrorRowCnt">
              <InputPath OutputPathName="OLEDBDEST stage_SalesOrderDetail.Error" />
            </RowCount>
            <FlatFileDestination Name="FF Errors stage_SalesOrderDetail" ConnectionName="FFC stage_SalesOrderDetail">
              <InputPath OutputPathName="RC Error.Output" />
            </FlatFileDestination>
          </Transformations>
        </Dataflow>
        <ExecuteSQL Name="SQL Count Final stage_SalesOrderDetail" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.FinalTableRowCnt" />
          </Results>
          <DirectInput>SELECT COUNT(*) FROM [stage].[SalesOrderDetail];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Audit End" ConnectionName="OLEDB_Staging">
          <Parameters>
            <Parameter Name="@AuditId" VariableName="User.AuditId" DataType="Int32" />
            <Parameter Name="@ExtractRowCnt" VariableName="User.ExtractRowCnt" DataType="Int32" />
            <Parameter Name="@InsertRowCnt" VariableName="User.InsertRowCnt" DataType="Int32" />
            <Parameter Name="@UpdateRowCnt" VariableName="User.UpdateRowCnt" DataType="Int32" />
            <Parameter Name="@ErrorRowCnt" VariableName="User.ErrorRowCnt" DataType="Int32" />
            <Parameter Name="@InitialTableRowCnt" VariableName="User.InitialTableRowCnt" DataType="Int32" />
            <Parameter Name="@FinalTableRowCnt" VariableName="User.FinalTableRowCnt" DataType="Int32" />
            <Parameter Name="@TableMaxDateTime" VariableName="User.TableMaxDateTime" DataType="DateTime" />
          </Parameters>
          <DirectInput>
        exec spUpd_Audit ?, ?, ?, ?, ?, ?, ?, ?
    </DirectInput>
        </ExecuteSQL>
      </Tasks>
      <Connections>
        <Connection ConnectionName="FFC stage_SalesOrderDetail" />
      </Connections>
      <Parameters>
        <Parameter Name="ParentAuditId" DataType="Int32">-1</Parameter>
      </Parameters>
    </Package>
    <Package Name="Extract Sales_SalesOrderHeader" ConstraintMode="Linear" ProtectionLevel="EncryptSensitiveWithUserKey">
      <Variables>
        <Variable Name="ParentAuditId" DataType="Int32" EvaluateAsExpression="true">@[$Package::ParentAuditId]</Variable>
        <Variable Name="AuditId" DataType="Int32">-1</Variable>
        <Variable Name="TableSchemaName" DataType="String">Sales</Variable>
        <Variable Name="TableName" DataType="String">SalesOrderHeader</Variable>
        <Variable Name="SourceQuery" DataType="String">
                        SELECT [SalesOrderID], [RevisionNumber], [OrderDate], [DueDate], [ShipDate], [Status], [OnlineOrderFlag], [SalesOrderNumber], [PurchaseOrderNumber], [AccountNumber], [CustomerID], [SalesPersonID], [TerritoryID], [BillToAddressID], [ShipToAddressID], [ShipMethodID], [CreditCardID], [CreditCardApprovalCode], [CurrencyRateID], [SubTotal], [TaxAmt], [Freight], [TotalDue], [Comment], [rowguid], [ModifiedDate]
                        FROM [Sales].[SalesOrderHeader]
                    </Variable>
        <Variable Name="SourceQueryWhere" DataType="String"> WHERE [ModifiedDate] &gt; </Variable>
        <Variable Name="ExtractRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="InsertRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="UpdateRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="ErrorRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="InitialTableRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="FinalTableRowCnt" DataType="Int32">-1</Variable>
        <Variable Name="TableMaxDateTime" DataType="DateTime">1900-01-01</Variable>
        <Variable Name="IsSuccessful" DataType="String">N</Variable>
      </Variables>
      <Tasks>
        <ExecuteSQL Name="SQL Truncate stage_SalesOrderHeader" ConnectionName="OLEDB_Staging">
          <DirectInput>TRUNCATE TABLE [stage].[SalesOrderHeader];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Count Initial stage_SalesOrderHeader" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.InitialTableRowCnt" />
          </Results>
          <DirectInput>SELECT COUNT(*) FROM [stage].[SalesOrderHeader];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Max Table DateTime" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.TableMaxDateTime" />
          </Results>
          <DirectInput>
                        SELECT MAX([TableMaxDateTime]) FROM [dbo].[Audit] 
                            WHERE [TableSchemaName] = 'Sales' AND [TableName] = 'SalesOrderHeader';
                    </DirectInput>
        </ExecuteSQL>
        <Expression Name="EXP SourceQuery" Expression="@[User::SourceQuery] = @[$Project::InitialLoad] ?                                              @[User::SourceQuery] :                                             @[User::SourceQuery] + @[User::SourceQueryWhere] +                                                 &quot;'&quot; + (DT_WSTR, 30) @[User::TableMaxDateTime] +  &quot;'&quot;" />
        <ExecuteSQL Name="SQL Audit Begin" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.AuditId" />
          </Results>
          <Parameters>
            <Parameter Name="@ParentAuditId" VariableName="User.ParentAuditId" DataType="Int32" />
            <Parameter Name="@ExecutionInstanceGUID" VariableName="System.ExecutionInstanceGUID" DataType="Guid" />
            <Parameter Name="@MachineName" VariableName="System.MachineName" DataType="String" />
            <Parameter Name="@PackageID" VariableName="System.PackageID" DataType="Guid" />
            <Parameter Name="@ServerExecutionId" VariableName="System.ServerExecutionID" DataType="String" />
            <Parameter Name="@StartTime" VariableName="System.StartTime" DataType="DateTime" />
            <Parameter Name="@UserName" VariableName="System.UserName" DataType="String" />
            <Parameter Name="@VersionBuild" VariableName="System.VersionBuild" DataType="Int16" />
            <Parameter Name="@VersionGUID" VariableName="System.VersionGUID" DataType="Guid" />
            <Parameter Name="@VersionMajor" VariableName="System.VersionMajor" DataType="Int32" />
            <Parameter Name="@VersionMinor" VariableName="System.VersionMinor" DataType="Int32" />
            <Parameter Name="@TableSchemaName" VariableName="User.TableSchemaName" DataType="String" />
            <Parameter Name="@TableName" VariableName="User.TableName" DataType="String" />
            <Parameter Name="@ExtractRowCnt" VariableName="User.ExtractRowCnt" DataType="Int32" />
            <Parameter Name="@InsertRowCnt" VariableName="User.InsertRowCnt" DataType="Int32" />
            <Parameter Name="@UpdateRowCnt" VariableName="User.UpdateRowCnt" DataType="Int32" />
            <Parameter Name="@ErrorRowCnt" VariableName="User.ErrorRowCnt" DataType="Int32" />
            <Parameter Name="@InitialTableRowCnt" VariableName="User.InitialTableRowCnt" DataType="Int32" />
            <Parameter Name="@FinalTableRowCnt" VariableName="User.FinalTableRowCnt" DataType="Int32" />
            <Parameter Name="@TableMaxDateTime" VariableName="User.TableMaxDateTime" DataType="DateTime" />
            <Parameter Name="@IsSuccessful" VariableName="User.IsSuccessful" DataType="String" />
          </Parameters>
          <DirectInput>
        exec dbo.spIns_Audit ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?,
                             ?, ?, ?, ?, ?, ?
                        
    </DirectInput>
        </ExecuteSQL>
        <Dataflow Name="DFT Extract Sales_SalesOrderHeader to Staging">
          <Transformations>
            <OleDbSource Name="OLEDBSRC Sales_SalesOrderHeader" ConnectionName="OLEDB_Source">
              <VariableInput VariableName="User.SourceQuery" />
            </OleDbSource>
            <RowCount Name="RC Extract" VariableName="User.ExtractRowCnt" />
            <OleDbDestination Name="OLEDBDEST stage_SalesOrderHeader" ConnectionName="OLEDB_Staging">
              <ErrorHandling ErrorRowDisposition="RedirectRow" TruncationRowDisposition="RedirectRow" />
              <ExternalTableOutput Table="[stage].[SalesOrderHeader]" />
            </OleDbDestination>
            <RowCount Name="RC Error" VariableName="User.ErrorRowCnt">
              <InputPath OutputPathName="OLEDBDEST stage_SalesOrderHeader.Error" />
            </RowCount>
            <FlatFileDestination Name="FF Errors stage_SalesOrderHeader" ConnectionName="FFC stage_SalesOrderHeader">
              <InputPath OutputPathName="RC Error.Output" />
            </FlatFileDestination>
          </Transformations>
        </Dataflow>
        <ExecuteSQL Name="SQL Count Final stage_SalesOrderHeader" ConnectionName="OLEDB_Staging" ResultSet="SingleRow">
          <Results>
            <Result Name="0" VariableName="User.FinalTableRowCnt" />
          </Results>
          <DirectInput>SELECT COUNT(*) FROM [stage].[SalesOrderHeader];</DirectInput>
        </ExecuteSQL>
        <ExecuteSQL Name="SQL Audit End" ConnectionName="OLEDB_Staging">
          <Parameters>
            <Parameter Name="@AuditId" VariableName="User.AuditId" DataType="Int32" />
            <Parameter Name="@ExtractRowCnt" VariableName="User.ExtractRowCnt" DataType="Int32" />
            <Parameter Name="@InsertRowCnt" VariableName="User.InsertRowCnt" DataType="Int32" />
            <Parameter Name="@UpdateRowCnt" VariableName="User.UpdateRowCnt" DataType="Int32" />
            <Parameter Name="@ErrorRowCnt" VariableName="User.ErrorRowCnt" DataType="Int32" />
            <Parameter Name="@InitialTableRowCnt" VariableName="User.InitialTableRowCnt" DataType="Int32" />
            <Parameter Name="@FinalTableRowCnt" VariableName="User.FinalTableRowCnt" DataType="Int32" />
            <Parameter Name="@TableMaxDateTime" VariableName="User.TableMaxDateTime" DataType="DateTime" />
          </Parameters>
          <DirectInput>
        exec spUpd_Audit ?, ?, ?, ?, ?, ?, ?, ?
    </DirectInput>
        </ExecuteSQL>
      </Tasks>
      <Connections>
        <Connection ConnectionName="FFC stage_SalesOrderHeader" />
      </Connections>
      <Parameters>
        <Parameter Name="ParentAuditId" DataType="Int32">-1</Parameter>
      </Parameters>
    </Package>
  </Packages>
  <Schemas>
    <Schema Name="Production" DatabaseName="sourceDb" />
    <Schema Name="Sales" DatabaseName="sourceDb" />
    <Schema Name="stage" DatabaseName="stagingDb" />
  </Schemas>
  <FileFormats>
    <FlatFileFormat Name="FFF stage_Product">
      <Columns>
        <Column Name="ProductID" Delimiter="," />
        <Column Name="Name" Length="50" DataType="String" Delimiter="," />
        <Column Name="ProductNumber" Length="25" DataType="String" Delimiter="," />
        <Column Name="MakeFlag" DataType="Boolean" Delimiter="," />
        <Column Name="FinishedGoodsFlag" DataType="Boolean" Delimiter="," />
        <Column Name="Color" Length="15" DataType="String" Delimiter="," />
        <Column Name="SafetyStockLevel" DataType="Int16" Delimiter="," />
        <Column Name="ReorderPoint" DataType="Int16" Delimiter="," />
        <Column Name="StandardCost" DataType="Currency" Delimiter="," />
        <Column Name="ListPrice" DataType="Currency" Delimiter="," />
        <Column Name="Size" Length="5" DataType="String" Delimiter="," />
        <Column Name="SizeUnitMeasureCode" Length="3" DataType="StringFixedLength" Delimiter="," />
        <Column Name="WeightUnitMeasureCode" Length="3" DataType="StringFixedLength" Delimiter="," />
        <Column Name="Weight" DataType="Decimal" Delimiter="," />
        <Column Name="DaysToManufacture" Delimiter="," />
        <Column Name="ProductLine" Length="2" DataType="StringFixedLength" Delimiter="," />
        <Column Name="Class" Length="2" DataType="StringFixedLength" Delimiter="," />
        <Column Name="Style" Length="2" DataType="StringFixedLength" Delimiter="," />
        <Column Name="ProductSubcategoryID" Delimiter="," />
        <Column Name="ProductModelID" Delimiter="," />
        <Column Name="SellStartDate" DataType="DateTime" Delimiter="," />
        <Column Name="SellEndDate" DataType="DateTime" Delimiter="," />
        <Column Name="DiscontinuedDate" DataType="DateTime" Delimiter="," />
        <Column Name="rowguid" DataType="Guid" Delimiter="," />
        <Column Name="ModifiedDate" DataType="DateTime" Delimiter="," />
        <Column Name="ErrorCode" Delimiter="," />
        <Column Name="ErrorColumn" Delimiter="CRLF" />
      </Columns>
    </FlatFileFormat>
    <FlatFileFormat Name="FFF stage_ProductCategory">
      <Columns>
        <Column Name="ProductCategoryID" Delimiter="," />
        <Column Name="Name" Length="50" DataType="String" Delimiter="," />
        <Column Name="rowguid" DataType="Guid" Delimiter="," />
        <Column Name="ModifiedDate" DataType="DateTime" Delimiter="," />
        <Column Name="ErrorCode" Delimiter="," />
        <Column Name="ErrorColumn" Delimiter="CRLF" />
      </Columns>
    </FlatFileFormat>
    <FlatFileFormat Name="FFF stage_ProductSubcategory">
      <Columns>
        <Column Name="ProductSubcategoryID" Delimiter="," />
        <Column Name="ProductCategoryID" Delimiter="," />
        <Column Name="Name" Length="50" DataType="String" Delimiter="," />
        <Column Name="rowguid" DataType="Guid" Delimiter="," />
        <Column Name="ModifiedDate" DataType="DateTime" Delimiter="," />
        <Column Name="ErrorCode" Delimiter="," />
        <Column Name="ErrorColumn" Delimiter="CRLF" />
      </Columns>
    </FlatFileFormat>
    <FlatFileFormat Name="FFF stage_SalesOrderDetail">
      <Columns>
        <Column Name="SalesOrderID" Delimiter="," />
        <Column Name="SalesOrderDetailID" Delimiter="," />
        <Column Name="CarrierTrackingNumber" Length="25" DataType="String" Delimiter="," />
        <Column Name="OrderQty" DataType="Int16" Delimiter="," />
        <Column Name="ProductID" Delimiter="," />
        <Column Name="SpecialOfferID" Delimiter="," />
        <Column Name="UnitPrice" DataType="Currency" Delimiter="," />
        <Column Name="UnitPriceDiscount" DataType="Currency" Delimiter="," />
        <Column Name="LineTotal" DataType="Decimal" Delimiter="," />
        <Column Name="rowguid" DataType="Guid" Delimiter="," />
        <Column Name="ModifiedDate" DataType="DateTime" Delimiter="," />
        <Column Name="ErrorCode" Delimiter="," />
        <Column Name="ErrorColumn" Delimiter="CRLF" />
      </Columns>
    </FlatFileFormat>
    <FlatFileFormat Name="FFF stage_SalesOrderHeader">
      <Columns>
        <Column Name="SalesOrderID" Delimiter="," />
        <Column Name="RevisionNumber" DataType="Byte" Delimiter="," />
        <Column Name="OrderDate" DataType="DateTime" Delimiter="," />
        <Column Name="DueDate" DataType="DateTime" Delimiter="," />
        <Column Name="ShipDate" DataType="DateTime" Delimiter="," />
        <Column Name="Status" DataType="Byte" Delimiter="," />
        <Column Name="OnlineOrderFlag" DataType="Boolean" Delimiter="," />
        <Column Name="SalesOrderNumber" Length="25" DataType="String" Delimiter="," />
        <Column Name="PurchaseOrderNumber" Length="25" DataType="String" Delimiter="," />
        <Column Name="AccountNumber" Length="15" DataType="String" Delimiter="," />
        <Column Name="CustomerID" Delimiter="," />
        <Column Name="SalesPersonID" Delimiter="," />
        <Column Name="TerritoryID" Delimiter="," />
        <Column Name="BillToAddressID" Delimiter="," />
        <Column Name="ShipToAddressID" Delimiter="," />
        <Column Name="ShipMethodID" Delimiter="," />
        <Column Name="CreditCardID" Delimiter="," />
        <Column Name="CreditCardApprovalCode" Length="15" DataType="AnsiString" Delimiter="," />
        <Column Name="CurrencyRateID" Delimiter="," />
        <Column Name="SubTotal" DataType="Currency" Delimiter="," />
        <Column Name="TaxAmt" DataType="Currency" Delimiter="," />
        <Column Name="Freight" DataType="Currency" Delimiter="," />
        <Column Name="TotalDue" DataType="Currency" Delimiter="," />
        <Column Name="Comment" Length="128" DataType="String" Delimiter="," />
        <Column Name="rowguid" DataType="Guid" Delimiter="," />
        <Column Name="ModifiedDate" DataType="DateTime" Delimiter="," />
        <Column Name="ErrorCode" Delimiter="," />
        <Column Name="ErrorColumn" Delimiter="CRLF" />
      </Columns>
    </FlatFileFormat>
  </FileFormats>
  <Databases>
    <Database Name="sourceDb" ConnectionName="OLEDB_Source" />
    <Database Name="stagingDb" ConnectionName="OLEDB_Staging" />
  </Databases>
</Biml>